var Model=function(f,g){var d=function(a){this._name=f;this.attributes=a||{};this.changes={};this.errors=[];this.trigger("initialize")};d.prototype=$.extend({attr:function(a,b){if(arguments.length==2){if(_.isEqual(this.attributes[a],b))delete this.changes[a];else this.changes[a]=b;return this}else{var c=this.changes[a];return c==undefined?this.attributes[a]:c}},callPersistMethod:function(a,b,c){if(this.persistence){var e=this;this.persistence[a](this,function(){b&&b.apply(e,arguments);e.trigger(a)},
c)}else this.trigger(a)},clearChanges:function(){this.changes={};return this},destroy:function(a,b){this.callPersistMethod("destroy",a,b);return this},id:function(){return this.attributes.id||null},newRecord:function(){return this.id()==null},save:function(a,b){if(!this.valid())return false;this.attributes=$.extend(this.attributes,this.changes);this.clearChanges();this.callPersistMethod(this.newRecord()?"create":"update",a,b);return true},toParam:function(){var a={};for(var b in this.attributes){var c=
this.attributes[b];if(b!="id"&&c!=null)a[this._name+"["+b+"]"]=c}return a},trigger:function(a){$(document).trigger([this._name,a].join(":"),[this]);return this},valid:function(){this.validate();return this.errors.length==0},validate:function(){this.errors=[];return this}},g);return d};
