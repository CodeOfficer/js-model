var Model=function(h,i){var e=function(a){this._name=h;this.attributes=a||{};this.changes={};this.errors=[];this.trigger("initialize")};e.prototype=$.extend({attr:function(a,b){if(arguments.length==2){if(_.isEqual(this.attributes[a],b))delete this.changes[a];else this.changes[a]=b;return this}else if(typeof a=="object"){for(var c in a)this.attr(c,a[c]);return this}else{c=this.changes[a];return c==undefined?this.attributes[a]:c}},callPersistMethod:function(a,b,c){var d=this,f=function(){if(d.collection)if(a==
"create")d.collection.add(d);else a=="destroy"&&d.collection.remove(d.id())};if(this.persistence)this.persistence[a](this,function(){f();var g;if(b)g=b.apply(d,arguments);d.trigger(a);return g},c);else{f();this.trigger(a)}},destroy:function(a,b){this.callPersistMethod("destroy",a,b);return this},id:function(){return this.attributes.id||null},newRecord:function(){return this.id()==null},reset:function(){this.changes={};return this},save:function(a,b){if(!this.valid())return false;this.attributes=$.extend(this.attributes,
this.changes);this.reset();this.callPersistMethod(this.newRecord()?"create":"update",a,b);return true},toParam:function(){var a={};for(var b in this.attributes){var c=this.attributes[b];if(b!="id"&&c!=null)a[this._name+"["+b+"]"]=c}return a},trigger:function(a){$(document).trigger([a,this._name].join("."),[this]);return this},valid:function(){this.validate();return this.errors.length==0},validate:function(){this.errors=[];return this}},i);return e};
